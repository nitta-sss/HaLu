{% load static %}
<!DOCTYPE html>
<html lang="ja">

    <head>
        <meta charset="UTF-8">
        <title>Halu UI</title>
        <link rel="stylesheet" href="{% static 'CSS/style.css' %}">
    </head>

    <body>

        <!-- ヘッダー -->
        <div class="header">
            <!-- 左上のアイコン -->
            <div class="user-box">

                <!-- アイコンの画像 -->
                <img src="{% static 'img/face.png' %}" class="icon">
                <span class="username">Halu</span>

                <!-- ゲージ表示切替ボタン -->
                <button id="toggle-btn">ゲージ非表示</button>

            </div>
        </div>


        <div class="container">

            <!-- ★★★ 左エリア ★★★ -->
            <div class="left-area">
                <div class="chat-box">

                    <!-- messages というリスト（配列）から1つずつ msg に取り出して使っているfor文 -->
                    {% for msg in messages %}
                        <!-- CSS で user と bot の吹き出しデザインを分ける -->
                        <div class="balloon {{ msg.sender }}">
                            <!-- テキスト表示 -->
                            {{ msg.text }}
                        </div>
                    {% endfor %}

                </div>

                <!-- 音声入力ボタン -->
                <div class="voice-icon">
                    <button id="voiceBtn"></button>
                </div>

            </div>

            <!-- ★★★ 右エリア ★★★ -->
            <div class="right-area">

                <!-- 右画面背景画像 -->
                <img src="{% static 'img/windows.jpg' %}" class="right-back">

                <!-- HaLuの顔画像 -->
                <div class="face-area">
                    <img src="{% static 'img/HaLu_Face.png' %}" class="face-img">
                </div>
            
                <!-- 感情ゲージ -->
                <div class="emotion-area fade" id="emotionArea">

                    <!-- 覚醒度バー -->
                    <div class="bar-item">
                        <div class="fade show">
                            <div class="bar-label">
                                覚醒度
                            </div>
                        </div>
                        <div class="bar-base">
                            <div class="bar-fill fill1" id="awakeBar"></div>
                        </div>
                    </div>

                    <!-- 快楽度バー -->
                    <div class="bar-item">
                        <div class="bar-label">
                            快楽度
                        </div>
                        <div class="bar-base" class="fade show">
                            <div class="bar-fill fill2" id="pleasureBar"></div>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <script>
        document.addEventListener("DOMContentLoaded", function () {

            const awakeBar = document.getElementById("awakeBar");
            const pleasureBar = document.getElementById("pleasureBar");

            let emotion = {
                x: 20,
                y: 80
            };

            function updateGauge() {
                awakeBar.style.width = emotion.x + "%";
                pleasureBar.style.width = emotion.y + "%";
                updateGaugeColors(emotion.x, emotion.y);
            }

            updateGauge();

            setInterval(function () {
                emotion.x = Math.floor(Math.random() * 101);
                emotion.y = Math.floor(Math.random() * 101);
                updateGauge();
            }, 3000);

            /* ★ 色変化の関数 ★ */
            function updateGaugeColors(x, y) {

                /* --- 覚醒度：赤→オレンジ→黄 --- */
                let v1 = x / 100;
            let r1 = Math.round(255 * v1);
            let b1 = Math.round(255 * (1 - v1));
            let color1 = `rgb(${r1}, 0, ${b1})`;

            awakeBar.style.background = `linear-gradient(to right, ${color1}, #ffffff60)`;


            /* --- 快楽度（★赤→オレンジ→黄） --- */
            if (y < 30) {
                pleasureBar.style.background = "linear-gradient(to right, red, orange)";
            } else if (y < 70) {
                pleasureBar.style.background = "linear-gradient(to right, orange, yellow)";
            } else {
                pleasureBar.style.background = "linear-gradient(to right, yellow, lightyellow)";
            }
        }

            /* ▼▼ ゲージ表示/非表示ボタン ▼▼ */
            const btn = document.getElementById("toggle-btn");
            const gauge = document.getElementById("emotionArea");

            btn.addEventListener("click", function () {
                gauge.classList.toggle("hide");
                btn.textContent = gauge.classList.contains("hide") ? "ゲージ表示" : "ゲージ非表示";
            });

        });  
        </script>
        <script src="{% static 'js/voice_animation.js' %}"></script>
    </body>
</html>